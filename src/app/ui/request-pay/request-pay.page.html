<ion-header>
    <ion-toolbar color="primary">
        <ion-buttons slot="start">
            <ion-menu-button color="dark"></ion-menu-button>
        </ion-buttons>
        <ion-title>
            Send a Z@P Request-to-Pay
        </ion-title>
    </ion-toolbar>
</ion-header>

<ion-content padding>
    <ng-template #loading>
        Loading Form...
    </ng-template>
    <form [formGroup]="payForm" *ngIf="userO" [hidden]="success" (ngSubmit)="this.doPayRequest()">
        <ng-container>
            <ion-card>
                <ion-card-content>
                    <ion-list lines="none">
                        <ion-input type="text" readonly formControlName="payeePSP" hidden></ion-input>
                        <ion-item>
                            <ion-label>
                                Amount
                            </ion-label>
                            <ion-input #amt class="largeAmount" formControlName="amountdisplay" type="text" pattern="[0-9.,]*"
                                inputmode="numeric" placeholder="0.00" (ionChange)="formatAmount(amt.value)" autofocus="true"></ion-input>
                            <ion-input formControlName="amount" type="number" required="true" hidden></ion-input>
                            <ion-badge slot="start" color="danger" *ngIf="!payForm.controls.amount.valid && payForm.controls.amountdisplay.dirty"
                                (click)="whatError('amount')">!</ion-badge>
                        </ion-item>

                    </ion-list>
                    <ion-segment (ionChange)="segmentChanged($event)" [value]="recipient" color="primary">
                        <ion-segment-button value="zap">
                            Z@P Id
                        </ion-segment-button>
                        <ion-segment-button value="mobile">
                            Mobile
                        </ion-segment-button>
                        <ion-segment-button value="email">
                            Email
                        </ion-segment-button>
                    </ion-segment>
                    <ion-list lines="none" [hidden]="recipientZAP">
                        <ion-grid fixed>
                            <ion-row>
                                <ion-col>
                                    <ion-input size="5" class="gridMiddle" formControlName="payerId" type="text"
                                        placeholder="Z@pId" #zapid></ion-input>
                                </ion-col>
                                <ion-col size="1" class="gridMiddle">@</ion-col>
                                <ion-col>
                                    <ion-select size="5" class="gridMiddle" placeholder="Select" formControlName="payerPSP">
                                        <ion-select-option *ngFor="let psp of processors | async" [value]="psp.id">{{psp.id}}</ion-select-option>
                                    </ion-select>
                                </ion-col>
                            </ion-row>
                        </ion-grid>
                    </ion-list>
                    <ion-list lines="none" [hidden]="recipientMobile">
                        <ion-grid fixed>
                            <ion-row>
                                <ion-col>
                                    <ion-input class="gridMiddle" formControlName="payerMobileNo" type="tel" inputmode="tel"
                                        placeholder="2700 000 0000" #zapid></ion-input>
                                </ion-col>
                            </ion-row>
                        </ion-grid>

                    </ion-list>
                    <ion-list lines="none" [hidden]="recipientEmail">
                        <ion-grid fixed>
                            <ion-row>
                                <ion-col>
                                    <ion-input class="gridMiddle" formControlName="payerEmail" type="email" placeholder="Requestee Email"
                                        inputmode="email" #zapid></ion-input>
                                </ion-col>
                            </ion-row>
                        </ion-grid>
                    </ion-list>
                </ion-card-content>
            </ion-card>
            <div class="center">
                <ion-img src="/assets/img/down-arrow-gif-8.gif" style="height: 40px"></ion-img>
            </div>
            <ion-card>
                <ion-card-content>
                    <ion-item>
                        <ion-badge slot="start" color="danger" *ngIf="!payForm.controls.userRef.valid && payForm.controls.userRef.dirty">!</ion-badge>
                        <ion-label>My Reference</ion-label>
                        <ion-input formControlName="userRef" type="text" placeholder="Payment reference" required="true"></ion-input>
                    </ion-item>
                    <ion-input type="text" hidden readonly formControlName="payeeId"></ion-input>
                    <ion-item *ngIf="useDefaultAccount" (click)="overideAccount()">
                        <ion-label>
                            Into Account?
                        </ion-label>
                        <ng-container *ngIf="defaultAccount">{{defaultAccount.accountAlias}}</ng-container>
                    </ion-item>
                    <ion-input hidden type="text" formControlName="payeeAccountRef"></ion-input>
                    <ion-item *ngIf="!useDefaultAccount">
                        <ion-label>
                            Into Account?
                        </ion-label>
                        <ion-select required="true" formControlName="payeeAccountRef" placeholder="Select Acct">
                            <ion-select-option *ngFor="let acc of accounts" [value]="acc.accountRef">
                                {{acc.accountAlias}}
                            </ion-select-option>
                        </ion-select>
                        <ion-badge slot="start" color="danger" *ngIf="!payForm.controls.payeeAccountRef.valid" (click)="whatError('payeeAccountRef')">!</ion-badge>
                    </ion-item>

                </ion-card-content>
            </ion-card>

            <ion-grid fixed>
                <ion-row>
                    <ion-col size="8">
                        <ion-button type="submit" [disabled]="!payForm.valid" expand="block" color="primary">
                            <ion-icon slot="start" name="cash"></ion-icon>
                            Send Z@P Request!
                        </ion-button>
                    </ion-col>
                    <ion-col size="4">
                        <ion-button (click)="showQR()" color="tertiary">
                            <ion-icon slot="end" name="barcode"></ion-icon>
                            Show QR
                        </ion-button>
                    </ion-col>
                </ion-row>
            </ion-grid>


            <div *ngIf="!payForm.valid">
                <span class="errorMsg">Form incomplete or invalid.</span>
            </div>
            <label *ngIf="myPSP" class="errorMsg"> {{apiUrl}}{{myPsp}} </label>
            <!-- <label> {{firstNumber}} </label> -->
        </ng-container>

    </form>
    <!-- <pre>

{{ selectedContactNumbers | json }}
</pre> -->
</ion-content>